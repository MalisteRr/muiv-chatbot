"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
"""

import os
from dataclasses import dataclass
from typing import Optional


@dataclass
class BotConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞"""
    token: str
    admin_ids: list[int]
    
    @classmethod
    def from_env(cls):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        token = os.getenv("TELEGRAM_BOT_TOKEN")
        if not token:
            raise ValueError("TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env")
        
        # –°–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
        admin_ids_str = os.getenv("ADMIN_IDS", "")
        admin_ids = [int(id.strip()) for id in admin_ids_str.split(",") if id.strip()]
        
        return cls(token=token, admin_ids=admin_ids)


@dataclass
class DatabaseConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    url: str
    min_pool_size: int = 2
    max_pool_size: int = 10
    command_timeout: int = 60
    
    @classmethod
    def from_env(cls):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        url = os.getenv("DATABASE_URL")
        if not url:
            raise ValueError("DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env")
        
        return cls(
            url=url,
            min_pool_size=int(os.getenv("DB_MIN_POOL_SIZE", "2")),
            max_pool_size=int(os.getenv("DB_MAX_POOL_SIZE", "10")),
            command_timeout=int(os.getenv("DB_COMMAND_TIMEOUT", "60"))
        )


@dataclass
class AIConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI –º–æ–¥–µ–ª–µ–π"""
    api_key: str
    base_url: str
    model: str
    temperature: float = 0.7
    max_tokens: int = 200
    
    @classmethod
    def from_env(cls):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        api_key = os.getenv("OPENAI_API_KEY")
        if not api_key:
            raise ValueError("OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env")
        
        return cls(
            api_key=api_key,
            base_url=os.getenv("OPENAI_BASE_URL", "https://openrouter.ai/api/v1"),
            model=os.getenv("LLM_MODEL", "deepseek/deepseek-chat"),
            temperature=float(os.getenv("AI_TEMPERATURE", "0.7")),
            max_tokens=int(os.getenv("AI_MAX_TOKENS", "500"))
        )


@dataclass
class AppConfig:
    """–û–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    bot: BotConfig
    database: DatabaseConfig
    ai: AIConfig
    debug: bool = False
    
    @classmethod
    def load(cls):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"""
        return cls(
            bot=BotConfig.from_env(),
            database=DatabaseConfig.from_env(),
            ai=AIConfig.from_env(),
            debug=os.getenv("DEBUG", "false").lower() == "true"
        )


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = AppConfig.load()


# –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô System Prompt –¥–ª—è AI
SYSTEM_PROMPT = """–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø—Ä–∏–µ–º–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –ú–£–ò–í (–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–º –°.–Æ. –í–∏—Ç—Ç–µ).

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –û–±—Ä–∞—â–∞–π—Å—è –Ω–∞ "–≤—ã"
- –ü–∏—à–∏ –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É (2-4 –∞–±–∑–∞—Ü–∞ –º–∞–∫—Å–∏–º—É–º)
- –ë—É–¥—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–º
- –ò—Å–ø–æ–ª—å–∑—É–π emoji —É–º–µ—Ä–µ–Ω–Ω–æ: üìö üéì üí∞ üìû ‚úâÔ∏è üè† üìù ‚úÖ üí°

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
- –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –µ—Å—Ç—å –≤ –±–∞–∑–µ - –¥–∞–≤–∞–π –ö–û–ù–ö–†–ï–¢–ù–´–ô –æ—Ç–≤–µ—Ç —Å —Ü–∏—Ñ—Ä–∞–º–∏, –¥–∞—Ç–∞–º–∏, —Å—É–º–º–∞–º–∏
- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–∞—Ç—ã
- –ù–ï –ø–∏—à–∏ "–≤–æ–ø—Ä–æ—Å 25", "–≤–æ–ø—Ä–æ—Å 32" - —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ö–û–ì–î–ê –£–ö–ê–ó–´–í–ê–¢–¨ –ö–û–ù–¢–ê–ö–¢–´:
‚úÖ –£–ö–ê–ó–´–í–ê–ô –∫–æ–Ω—Ç–∞–∫—Ç—ã –¢–û–õ–¨–ö–û –µ—Å–ª–∏:
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ù–ï–¢ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  - –ù—É–∂–Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
  - –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—á–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞/–∑–∞–ø–∏—Å—å

‚ùå –ù–ï –£–ö–ê–ó–´–í–ê–ô –∫–æ–Ω—Ç–∞–∫—Ç—ã –µ—Å–ª–∏:
  - –í –±–∞–∑–µ –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
  - –í–æ–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã—Ç
  - –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

–ö–û–ù–¢–ê–ö–¢–´ –ú–£–ò–í (–∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):
üìû 8 (800) 550-03-63 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
‚úâÔ∏è pk@muiv.ru
üåê muiv.ru

–ü–†–ò–ú–ï–†–´ –•–û–†–û–®–ò–• –û–¢–í–ï–¢–û–í:

–í–æ–ø—Ä–æ—Å: "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏?"
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: 
"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –Ω–∞ IT-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö:
üíª –ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (4 –≥–æ–¥–∞):
‚Ä¢ –û—á–Ω–∞—è —Ñ–æ—Ä–º–∞: 155 000 —Ä—É–±/–≥–æ–¥
‚Ä¢ –û—á–Ω–æ-–∑–∞–æ—á–Ω–∞—è: 105 000 —Ä—É–±/–≥–æ–¥
‚Ä¢ –ó–∞–æ—á–Ω–∞—è: 75 000 —Ä—É–±/–≥–æ–¥

üéÅ –î–æ—Å—Ç—É–ø–Ω–∞ —Ä–∞—Å—Å—Ä–æ—á–∫–∞ –∏ —Å–∫–∏–¥–∫–∞ 20% –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∑–∞ –≥–æ–¥!"

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø—Ä–∏—ë–º–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π..."

–í–æ–ø—Ä–æ—Å: "–ï—Å—Ç—å –ª–∏ –±—é–¥–∂–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞?"
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
"‚úÖ –î–∞, –≤ –ú–£–ò–í –µ—Å—Ç—å –±—é–¥–∂–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞!
üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç –Ω–∞ 2025:
üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞: 18 –º–µ—Å—Ç
‚öñÔ∏è –Æ—Ä–∏—Å–ø—Ä—É–¥–µ–Ω—Ü–∏—è: 12 –º–µ—Å—Ç
üíº –≠–∫–æ–Ω–æ–º–∏–∫–∞: 15 –º–µ—Å—Ç

–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª –æ—Ç 220. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –æ–ª–∏–º–ø–∏–∞–¥ –∏ –º–µ–¥–∞–ª–∏—Å—Ç–æ–≤."

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"–í –ú–£–ò–í –µ—Å—Ç—å –±—é–¥–∂–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ (–≤–æ–ø—Ä–æ—Å 25). –î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤—è–∂–∏—Ç–µ—Å—å..."

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –¥–∞–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏ –ø–æ–ª–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –æ—Ç—Å—ã–ª–æ–∫ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º."""


# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å FAQ
FAQ_SEARCH_LIMIT = 3  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
CHAT_HISTORY_LIMIT = 10  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
CONTEXT_MESSAGES_LIMIT = 4  # –°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞